# 使用方法

One Codespace の基本的な使い方と各機能の詳細を説明します。

## 基本操作

### ポップアップの表示

1. Chrome ツールバーの One Codespace アイコンをクリック
2. ポップアップウィンドウが開きます

### ポップアップの構成

```
┌─────────────────────────────────────┐
│ One Codespace      [🔄] [⚙️]      │ ← ヘッダー
├─────────────────────────────────────┤
│ □ owner/repo-name                   │
│   状態: アクティブ  ⏱ 15分前      │
│   [停止]                            │ ← Codespace アイテム
├─────────────────────────────────────┤
│ □ owner/another-repo                │
│   状態: アクティブ  ⏱ 30分前      │
│   [停止]                            │
├─────────────────────────────────────┤
│ ● 接続中         2 個の Codespace  │ ← フッター
└─────────────────────────────────────┘
```

#### ヘッダーアイコン

- **🔄（更新）**: Codespace リストを手動で更新
- **⚙️（設定）**: 設定画面を開く

#### Codespace アイテム

各 Codespace には以下の情報が表示されます：

- **リポジトリ名**: オーナー/リポジトリ形式
- **状態**: アクティブ、停止中など
- **起動時間**: Codespace が起動してからの時間
- **停止ボタン**: 手動で停止

#### フッター

- **接続状態**: GitHub API への接続状態
- **Codespace 数**: アクティブな Codespace の総数

## 主要機能の使い方

### 1. Codespace の一覧表示

#### アクティブな Codespace を確認

1. ポップアップを開く
2. 現在アクティブなすべての Codespace が表示されます
3. 各 Codespace の詳細情報を確認

#### 表示される情報

- **リポジトリ名**: GitHub リポジトリの完全な名前
- **状態インジケーター**:
  - 🟢 アクティブ: 起動中
  - ⚫ 停止中: 停止済み
- **起動時間**:
  - "1分未満"
  - "15分前"
  - "2時間前"
  - "3日前"

#### リストの更新

自動更新：
- ポップアップを開くたびに自動的に更新

手動更新：
1. 更新アイコン（🔄）をクリック
2. リストが最新の状態に更新されます

### 2. Codespace の手動停止

#### 単一の Codespace を停止

1. ポップアップを開く
2. 停止したい Codespace を見つける
3. 「停止」ボタンをクリック
4. 確認なしですぐに停止されます
5. 通知が表示されます

#### 停止プロセス

```
[停止] クリック
  ↓
ローディング表示
  ↓
GitHub API 呼び出し
  ↓
成功/失敗の通知
  ↓
リスト更新
```

#### 注意事項

- **保存されていないデータ**: 停止前に Codespace 内のデータを保存してください
- **即座に停止**: 確認ダイアログはありません
- **復元**: 停止した Codespace は GitHub から再起動できます

### 3. 自動停止機能

#### 機能の有効化

1. 設定画面を開く
2. 「自動停止を有効にする」をONにする
3. 保存

#### 自動停止の条件

##### A. 最大同時起動数による停止

**動作**:
1. 設定した最大数（デフォルト: 1）を超える Codespace が起動
2. 最も古い（最後にアクセスした時刻が古い）Codespace が自動停止
3. 通知が表示される

**例**:
```
最大数: 1
現在アクティブ: 2個

Codespace A（最終アクセス: 1時間前）← 自動停止
Codespace B（最終アクセス: 5分前）← そのまま
```

##### B. 非アクティブ時間による停止

**動作**:
1. Codespace のタブがバックグラウンドになる
2. 設定した時間（デフォルト: 30分）経過
3. 定期チェック（5分ごと）で検出
4. 自動停止
5. 通知が表示される

**アクティビティの判定**:
- Codespace のタブをアクティブにする → アクティビティとして記録
- タブを切り替える → 非アクティブとしてカウント開始
- ブラウザを閉じる → 最後のアクセス時刻が保持される

#### 定期チェックのタイミング

- **間隔**: 5分ごと
- **実行内容**:
  1. すべてのアクティブな Codespace を取得
  2. 最終アクセス時刻をチェック
  3. 自動停止の条件を満たすものを停止

### 4. 除外リポジトリ機能

#### 除外リポジトリとは

特定のリポジトリの Codespace を自動停止の対象外にする機能です。

#### 使用例

- **長時間実行するタスク**: ビルドやテストが長時間かかる
- **本番環境**: 常時起動しておきたい
- **重要なプロジェクト**: 誤って停止されたくない

#### 設定方法

1. 設定画面を開く
2. 「除外リポジトリ」セクションを見つける
3. リポジトリ名を入力（例: `owner/repository`）
4. 「追加」ボタンをクリック
5. 保存

#### 除外リポジトリの削除

1. 設定画面の除外リポジトリリストを確認
2. 削除したいリポジトリのタグの「×」をクリック
3. 保存

#### 注意事項

- リポジトリ名は `owner/repository` 形式で入力
- 部分一致もサポート（`owner` だけでも可）
- 除外リポジトリは手動停止には影響しません

### 5. 通知機能

#### 通知が表示されるタイミング

1. **Codespace が自動停止されたとき**
   - 最大数超過による停止
   - 非アクティブによる停止

2. **手動停止が成功したとき**
   - ポップアップから停止ボタンをクリック

3. **エラーが発生したとき**
   - トークンの問題
   - ネットワークエラー

#### 通知の内容

```
┌─────────────────────────────────┐
│ Codespace を自動停止しました      │
│ owner/repository (30分非アクティブ) │
└─────────────────────────────────┘
```

#### 通知の設定

Chrome の通知設定で、One Codespace からの通知を管理できます：

1. Chrome 設定 → プライバシーとセキュリティ → サイトの設定 → 通知
2. One Codespace を探す
3. 許可/ブロックを設定

### 6. ダークモード

#### ダークモードの有効化

1. 設定画面を開く
2. 「ダークモード」をONにする
3. 保存
4. すぐに適用されます

#### ダークモードの特徴

- Material Design のダークテーマに準拠
- 目に優しいカラーパレット
- すべての画面（ポップアップ、設定）に適用

## よくある使用シナリオ

### シナリオ 1: 複数プロジェクトの開発

**状況**: 複数のプロジェクトで作業中だが、コスト削減したい

**設定**:
```
最大 Codespace 数: 2
自動停止時間: 15分
```

**動作**:
- 3つ目の Codespace を開くと、最も古いものが自動停止
- 15分使わないと自動停止

### シナリオ 2: 単一プロジェクトに集中

**状況**: 1つのプロジェクトに集中して作業

**設定**:
```
最大 Codespace 数: 1
自動停止時間: 30分
```

**動作**:
- 新しい Codespace を開くと、前のものが即座に停止
- 30分放置すると自動停止

### シナリオ 3: 本番環境の除外

**状況**: 本番環境の Codespace は常時起動しておきたい

**設定**:
```
除外リポジトリ: company/production
最大 Codespace 数: 1
```

**動作**:
- `company/production` は自動停止されない
- その他の Codespace は通常通り管理

### シナリオ 4: 長時間タスク

**状況**: ビルドやテストに時間がかかる

**設定**:
```
自動停止時間: 120分
または
除外リポジトリに追加
```

**動作**:
- 120分まで自動停止されない
- または完全に除外

## ベストプラクティス

### 1. 適切な最大数の設定

- **1個**: コスト最優先、単一プロジェクト
- **2-3個**: バランス型、複数プロジェクト
- **4個以上**: 柔軟性優先、チーム開発

### 2. 自動停止時間の設定

- **5-15分**: 短時間の作業、頻繁な切り替え
- **30分**: 標準的な作業（推奨）
- **60-120分**: 長時間の作業、ビルドタスク

### 3. 除外リポジトリの活用

- **本番環境**: 必ず除外
- **CI/CD**: 長時間実行する場合は除外
- **実験的プロジェクト**: 除外しない

### 4. 定期的な確認

- 週に1回、ポップアップで Codespace の状態を確認
- 不要な Codespace がないかチェック
- 設定が適切か見直し

## トラブルシューティング

使用中に問題が発生した場合は、[TROUBLESHOOTING.md](TROUBLESHOOTING.md) を参照してください。

---

その他の質問や機能のリクエストは、GitHub Issues で報告してください。
