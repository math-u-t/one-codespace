# 設定ガイド

One Codespace の詳細な設定方法と各オプションについて説明します。

## 設定画面へのアクセス

設定画面を開く方法：

1. **ポップアップから**
   - ツールバーのアイコンをクリック
   - 設定アイコン（⚙️）をクリック

2. **右クリックメニューから**
   - ツールバーのアイコンを右クリック
   - 「オプション」を選択

3. **拡張機能管理ページから**
   - `chrome://extensions/` を開く
   - One Codespace の「詳細」をクリック
   - 「拡張機能のオプション」をクリック

## 設定項目

### 1. GitHub Personal Access Token

#### 概要
GitHub API にアクセスするための認証トークンです。

#### 設定方法
1. トークン入力フィールドにトークンを貼り付け
2. 👁️ アイコンで表示/非表示を切り替え可能
3. 「トークンを検証」ボタンで有効性を確認

#### トークンの検証

検証ボタンをクリックすると：

✅ **成功**:
```
✓ トークンは有効です（スコープ: codespace, repo）
```

❌ **失敗**:
```
✗ 認証に失敗しました
✗ codespace スコープがありません
```

#### セキュリティ

- トークンはブラウザのローカルストレージに保存
- 外部サーバーには送信されません
- 設定のエクスポートには含まれません

詳細は [API.md](API.md) を参照してください。

### 2. 自動停止設定

#### 自動停止を有効にする

**トグルスイッチ**: ON/OFF

- **ON**: 自動停止機能が有効
- **OFF**: 手動停止のみ

**推奨**: ON（コスト削減のため）

#### 最大同時起動 Codespace 数

**スライダー**: 1 ～ 10

- **デフォルト**: 1
- **最小**: 1（コスト最優先）
- **最大**: 10（柔軟性優先）

**動作**:
- この数を超えると、最も古い Codespace が自動停止
- 除外リポジトリはカウントされません

**推奨設定**:

| 用途 | 推奨値 | 理由 |
|------|-------|------|
| 個人開発（1プロジェクト） | 1 | コスト最小化 |
| 個人開発（複数プロジェクト） | 2-3 | バランス型 |
| チーム開発 | 3-5 | 柔軟性重視 |
| テスト環境 | 1-2 | コスト管理 |

#### 自動停止までの時間

**スライダー**: 5 ～ 120 分（5分刻み）

- **デフォルト**: 30分
- **最小**: 5分（積極的な停止）
- **最大**: 120分（長時間タスク対応）

**動作**:
- Codespace のタブが非アクティブになってからの時間
- 5分ごとの定期チェックで判定

**推奨設定**:

| 作業スタイル | 推奨値 | 理由 |
|-------------|-------|------|
| 短時間の作業 | 10-15分 | 素早く停止 |
| 標準的な作業 | 30分 | バランス型 |
| 長時間の作業 | 60分 | 余裕を持たせる |
| ビルド・テスト | 90-120分 | タスク完了を待つ |

#### 除外リポジトリ

**入力フォーム**: テキスト + チップ表示

**形式**: `owner/repository`

**例**:
```
company/production-app
myname/important-project
organization/ci-runner
```

**機能**:
- 指定したリポジトリは自動停止されません
- 部分一致もサポート（`company` だけでも可）
- 複数のリポジトリを追加可能

**追加方法**:
1. リポジトリ名を入力
2. 「追加」ボタンをクリック
3. チップとして表示される

**削除方法**:
- チップの「×」アイコンをクリック

**推奨用途**:
- 本番環境
- CI/CD パイプライン
- 長時間実行するタスク
- 重要なプロジェクト

### 3. 表示設定

#### ダークモード

**トグルスイッチ**: ON/OFF

- **ON**: ダークテーマを使用
- **OFF**: ライトテーマを使用

**特徴**:
- Material Design のダークテーマに準拠
- 目に優しいカラーパレット
- すべての画面に適用

**カラーパレット**:

| 要素 | ライトモード | ダークモード |
|------|------------|------------|
| 背景 | #FFFFFF | #121212 |
| サーフェス | #FAFAFA | #1E1E1E |
| プライマリ | #1976D2 | #90CAF9 |
| テキスト | #212121 | #FFFFFF |

### 4. インポート/エクスポート

#### 設定のエクスポート

**ボタン**: 「エクスポート」

**動作**:
1. 現在の設定を JSON ファイルとしてダウンロード
2. ファイル名: `one-codespace-settings-YYYY-MM-DD.json`
3. **GitHub トークンは含まれません**（セキュリティのため）

**用途**:
- 設定のバックアップ
- 複数のブラウザ間で設定を共有
- チームメンバーとの設定共有

**エクスポートされる項目**:
```json
{
  "autoStopEnabled": true,
  "maxCodespaces": 1,
  "autoStopMinutes": 30,
  "excludedRepos": ["owner/repo"],
  "darkMode": false,
  "language": "ja"
}
```

#### 設定のインポート

**ボタン**: 「インポート」

**動作**:
1. ファイル選択ダイアログが開く
2. エクスポートした JSON ファイルを選択
3. 設定が読み込まれる
4. **GitHub トークンは保持されます**

**注意事項**:
- 現在の設定は上書きされます
- GitHub トークンは変更されません
- 無効な JSON ファイルはエラーになります

## 設定の保存

すべての変更は「保存」ボタンをクリックするまで適用されません。

**保存プロセス**:
```
設定変更
  ↓
保存ボタンクリック
  ↓
検証
  ↓
ストレージに保存
  ↓
成功/失敗の通知
```

**保存後**:
- 緑色の通知「設定を保存しました」が表示
- すぐに設定が適用されます
- バックグラウンドプロセスが再起動されます

## 推奨設定パターン

### パターン 1: コスト最優先

```
自動停止: ON
最大 Codespace 数: 1
自動停止時間: 15分
除外リポジトリ: なし
```

**メリット**: 最小限のコスト
**デメリット**: 頻繁に停止される

### パターン 2: バランス型（推奨）

```
自動停止: ON
最大 Codespace 数: 2
自動停止時間: 30分
除外リポジトリ: 本番環境のみ
```

**メリット**: コストと柔軟性のバランス
**デメリット**: なし

### パターン 3: 柔軟性優先

```
自動停止: ON
最大 Codespace 数: 5
自動停止時間: 60分
除外リポジトリ: 複数設定
```

**メリット**: 柔軟な作業が可能
**デメリット**: コストが高め

### パターン 4: 長時間タスク

```
自動停止: ON
最大 Codespace 数: 1
自動停止時間: 120分
除外リポジトリ: CI/CD リポジトリ
```

**メリット**: ビルド・テストが中断されない
**デメリット**: 放置時のコストが高い

### パターン 5: チーム開発

```
自動停止: ON
最大 Codespace 数: 3
自動停止時間: 45分
除外リポジトリ: 本番、ステージング
```

**メリット**: 複数プロジェクトに対応
**デメリット**: 個人よりコストが高い

## 高度な設定

### 定期チェックの間隔

現在は **5分** に固定されています。

将来のバージョンで設定可能になる予定です。

### アクティビティの判定

現在、以下の条件でアクティビティを判定：
- Codespace タブがアクティブ
- タブにフォーカスがある

将来的には以下も検討：
- ファイル編集の検知
- ターミナル操作の検知
- Git 操作の検知

## トラブルシューティング

### 設定が保存されない

**原因**: ブラウザのストレージ容量不足

**解決策**:
1. 不要な拡張機能を削除
2. ブラウザのキャッシュをクリア
3. Chrome を再起動

### トークン検証が失敗する

**原因**: トークンが無効、またはネットワークエラー

**解決策**:
1. トークンをコピーし直す
2. GitHub でトークンが有効か確認
3. `codespace` スコープがあるか確認
4. ネットワーク接続を確認

### 除外リポジトリが機能しない

**原因**: リポジトリ名の形式が間違っている

**解決策**:
1. `owner/repository` 形式で入力
2. スペースや特殊文字がないか確認
3. GitHub のリポジトリページで正確な名前を確認

### 設定がインポートできない

**原因**: JSON ファイルの形式が不正

**解決策**:
1. JSON バリデーターでファイルを確認
2. エクスポート機能で作成したファイルのみ使用
3. 手動編集は避ける

## 次のステップ

設定が完了したら：

1. [USAGE.md](USAGE.md) で実際の使い方を確認
2. [TROUBLESHOOTING.md](TROUBLESHOOTING.md) で問題が発生した場合の対処法を確認

---

設定に関する質問は、GitHub Issues で報告してください。
