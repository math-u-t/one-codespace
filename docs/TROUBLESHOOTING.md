# トラブルシューティング

One Codespace の使用中に発生する可能性のある問題と解決方法をまとめています。

## 目次

- [インストール関連](#インストール関連)
- [認証・トークン関連](#認証トークン関連)
- [Codespace 表示関連](#codespace-表示関連)
- [自動停止関連](#自動停止関連)
- [UI・表示関連](#ui表示関連)
- [パフォーマンス関連](#パフォーマンス関連)
- [その他](#その他)

## インストール関連

### 問題: 拡張機能が読み込めない

**エラー**: "Manifest file is missing or unreadable"

**原因**:
- `manifest.json` ファイルが壊れている
- JSON の形式が不正
- ファイルの文字コードが UTF-8 でない

**解決策**:
1. `manifest.json` を JSON バリデーターで確認
2. 余分なカンマや括弧がないか確認
3. ファイルを UTF-8 で保存し直す
4. 元のファイルと比較して修正

### 問題: 拡張機能がツールバーに表示されない

**原因**:
- デベロッパーモードが無効
- 拡張機能が無効化されている
- Chrome を再起動していない

**解決策**:
1. `chrome://extensions/` を開く
2. 「デベロッパーモード」をONにする
3. One Codespace が有効になっているか確認
4. Chrome を再起動

### 問題: アイコンが表示されない

**原因**:
- アイコンファイルが配置されていない
- `manifest.json` のパスが間違っている

**解決策**:
1. `icons/` ディレクトリに `icon16.png`, `icon48.png`, `icon128.png` があるか確認
2. `manifest.json` で icons セクションのコメントを解除
3. パスが正しいか確認
4. 拡張機能を再読み込み

詳細は [icons/README.md](../icons/README.md) を参照。

## 認証・トークン関連

### 問題: "GitHub Personal Access Token が設定されていません"

**原因**:
- トークンが入力されていない
- トークンが保存されていない

**解決策**:
1. 設定画面を開く
2. GitHub Personal Access Token を入力
3. 「保存」ボタンをクリック
4. ポップアップを開いて確認

詳細は [API.md](API.md) を参照。

### 問題: "GitHub トークンが無効です"

**原因**:
- トークンが間違っている
- トークンの有効期限が切れている
- トークンが削除されている

**解決策**:
1. GitHub でトークンの状態を確認
   - Settings → Developer settings → Personal access tokens
2. トークンをコピーし直す
3. 必要に応じて新しいトークンを生成
4. One Codespace の設定を更新

### 問題: "codespace スコープがありません"

**原因**:
- トークン生成時に `codespace` スコープを選択していない

**解決策**:
1. GitHub で新しいトークンを生成
2. `codespace` スコープを**必ず**選択
3. トークンをコピー
4. One Codespace の設定を更新

### 問題: "認証に失敗しました"

**原因**:
- ネットワークエラー
- GitHub API がダウンしている
- トークンの形式が不正

**解決策**:
1. インターネット接続を確認
2. [GitHub Status](https://www.githubstatus.com/) を確認
3. トークンが `ghp_` で始まる40文字の文字列か確認
4. スペースや改行が含まれていないか確認

## Codespace 表示関連

### 問題: Codespace が表示されない

**原因**:
- GitHub にアクティブな Codespace がない
- トークンの権限が不足
- API エラー

**解決策**:
1. GitHub で Codespace があるか確認
2. トークンを検証
3. 更新ボタン（🔄）をクリック
4. 開発者コンソールでエラーログを確認（下記参照）

### 問題: "Codespace の読み込みに失敗しました"

**原因**:
- ネットワークエラー
- GitHub API のレート制限
- 一時的な API エラー

**解決策**:
1. インターネット接続を確認
2. 数分待ってから再試行
3. レート制限の状態を確認（下記参照）
4. GitHub Status を確認

### 問題: Codespace のリストが更新されない

**原因**:
- キャッシュの問題
- バックグラウンドプロセスのエラー

**解決策**:
1. ポップアップを閉じて再度開く
2. 更新ボタン（🔄）をクリック
3. 拡張機能を再読み込み
4. Chrome を再起動

## 自動停止関連

### 問題: Codespace が自動停止されない

**原因**:
- 自動停止機能が無効
- 除外リポジトリに含まれている
- 設定時間が経過していない

**解決策**:
1. 設定画面で「自動停止を有効にする」がONか確認
2. 除外リポジトリリストを確認
3. 自動停止時間の設定を確認
4. 定期チェック（5分ごと）を待つ

### 問題: Codespace が意図せず停止される

**原因**:
- 自動停止時間が短すぎる
- 最大 Codespace 数が少なすぎる
- アクティビティが検知されていない

**解決策**:
1. 自動停止時間を長くする（例: 60分）
2. 最大 Codespace 数を増やす（例: 2-3個）
3. 重要なリポジトリを除外リストに追加
4. または自動停止を無効にする

### 問題: 除外リポジトリが機能しない

**原因**:
- リポジトリ名の形式が間違っている
- スペルミス

**解決策**:
1. `owner/repository` 形式で入力されているか確認
2. GitHub のリポジトリページで正確な名前を確認
3. 大文字・小文字を正しく入力
4. スペースや特殊文字がないか確認

### 問題: 通知が表示されない

**原因**:
- Chrome の通知設定で無効になっている
- 通知の権限が拒否されている

**解決策**:
1. Chrome 設定 → プライバシーとセキュリティ → サイトの設定 → 通知
2. One Codespace を探す
3. 「許可」に設定
4. Chrome を再起動

## UI・表示関連

### 問題: ポップアップが開かない

**原因**:
- 拡張機能がクラッシュしている
- ファイルの読み込みエラー

**解決策**:
1. `chrome://extensions/` を開く
2. One Codespace の「詳細」をクリック
3. 「エラー」セクションを確認
4. 拡張機能を再読み込み
5. Chrome を再起動

### 問題: ダークモードが適用されない

**原因**:
- 設定が保存されていない
- キャッシュの問題

**解決策**:
1. 設定画面でダークモードをON/OFFする
2. 「保存」ボタンをクリック
3. ポップアップを閉じて再度開く
4. Chrome を再起動

### 問題: スタイルが崩れている

**原因**:
- CSS ファイルの読み込みエラー
- Material Icons の読み込み失敗

**解決策**:
1. インターネット接続を確認（Material Icons は CDN から読み込み）
2. 開発者コンソールでエラーを確認
3. 拡張機能を再読み込み
4. ブラウザのキャッシュをクリア

## パフォーマンス関連

### 問題: ポップアップの表示が遅い

**原因**:
- Codespace の数が多い
- ネットワークが遅い
- API レスポンスが遅い

**解決策**:
1. インターネット接続を確認
2. 不要な Codespace を削除
3. キャッシュをクリア
4. Chrome を再起動

### 問題: CPU 使用率が高い

**原因**:
- バックグラウンドプロセスのバグ
- 定期チェックの頻度が高すぎる

**解決策**:
1. Chrome のタスクマネージャーで確認（Shift+Esc）
2. 拡張機能を再読み込み
3. 問題が続く場合は GitHub Issues で報告

### 問題: メモリ使用量が多い

**原因**:
- メモリリーク
- 長時間の使用

**解決策**:
1. Chrome を再起動
2. 他の拡張機能を無効にして確認
3. 問題が続く場合は GitHub Issues で報告

## その他

### 問題: 設定が保存されない

**原因**:
- ストレージ容量不足
- 権限の問題

**解決策**:
1. ブラウザのキャッシュをクリア
2. 不要な拡張機能を削除
3. `chrome.storage` の容量を確認（開発者コンソール）
4. Chrome を再起動

### 問題: 設定がリセットされる

**原因**:
- 拡張機能の再インストール
- ストレージのクリア

**解決策**:
1. 事前に設定をエクスポート
2. 設定を再入力
3. またはエクスポートしたファイルをインポート

### 問題: 拡張機能がクラッシュする

**原因**:
- JavaScript エラー
- メモリ不足
- Chrome のバグ

**解決策**:
1. `chrome://extensions/` でエラーログを確認
2. 拡張機能を再読み込み
3. Chrome を最新版に更新
4. 問題が続く場合は GitHub Issues で報告

## デバッグ方法

### 開発者コンソールの確認

#### ポップアップのコンソール

1. ポップアップを開く
2. ポップアップを右クリック
3. 「検証」を選択
4. Console タブでエラーを確認

#### バックグラウンドページのコンソール

1. `chrome://extensions/` を開く
2. One Codespace の「詳細」をクリック
3. 「Service Worker を検証」をクリック
4. Console タブでエラーを確認

#### 設定画面のコンソール

1. 設定画面を開く
2. ページを右クリック
3. 「検証」を選択
4. Console タブでエラーを確認

### ストレージの確認

開発者コンソールで以下を実行：

```javascript
// すべての設定を表示
chrome.storage.local.get(null, (data) => {
  console.log(data);
});

// 設定のみを表示
chrome.storage.local.get('settings', (data) => {
  console.log(data.settings);
});
```

### ネットワークリクエストの確認

1. 開発者ツールを開く
2. Network タブを選択
3. ポップアップを開くまたは更新ボタンをクリック
4. `api.github.com` へのリクエストを確認
5. ステータスコードとレスポンスを確認

### レート制限の確認

開発者コンソールで以下を実行：

```javascript
// トークンを取得
chrome.storage.local.get('settings', async (data) => {
  const token = data.settings.githubToken;

  // レート制限を確認
  const response = await fetch('https://api.github.com/rate_limit', {
    headers: {
      'Authorization': `Bearer ${token}`,
      'Accept': 'application/vnd.github+json'
    }
  });

  const data = await response.json();
  console.log(data);
});
```

## エラーメッセージ一覧

| エラーメッセージ | 原因 | 解決策 |
|----------------|------|--------|
| "GitHub Personal Access Token が設定されていません" | トークン未設定 | 設定画面でトークンを入力 |
| "GitHub トークンが無効です" | トークンが間違っている | トークンを確認・再生成 |
| "アクセスが拒否されました" | 権限不足 | `codespace` スコープを確認 |
| "ネットワークエラーが発生しました" | 接続エラー | インターネット接続を確認 |
| "Codespace の読み込みに失敗しました" | API エラー | 再試行、またはGitHub Status を確認 |
| "Codespace の停止に失敗しました" | API エラー | 再試行、またはトークンを確認 |
| "レート制限に達しました" | API 制限 | 時間を置いて再試行 |

## サポート

上記の解決策で問題が解決しない場合：

1. **GitHub Issues で報告**
   - エラーメッセージをコピー
   - 再現手順を記載
   - スクリーンショットを添付

2. **情報の提供**
   - Chrome のバージョン
   - 拡張機能のバージョン
   - OS（Windows、Mac、Linux）
   - エラーログ（開発者コンソールから）

3. **一時的な回避策**
   - 拡張機能を無効化
   - 手動で Codespace を管理
   - 設定を初期化

## よくある質問 (FAQ)

### Q: Codespace が勝手に停止されます

A: 自動停止機能が有効になっています。設定画面で時間を長くするか、除外リポジトリに追加してください。

### Q: トークンはどこに保存されますか？

A: ブラウザのローカルストレージ（`chrome.storage.local`）に保存されます。外部サーバーには送信されません。

### Q: 複数のブラウザで同じ設定を使えますか？

A: 設定のエクスポート/インポート機能を使用して、設定を共有できます。ただし、トークンは含まれないため、各ブラウザで個別に設定する必要があります。

### Q: アンインストールするとデータは削除されますか？

A: はい。アンインストールすると、すべての設定（トークンを含む）が削除されます。必要に応じて事前にエクスポートしてください。

---

問題が解決しない場合は、[GitHub Issues](https://github.com/your-username/one-codespace/issues) で報告してください。
